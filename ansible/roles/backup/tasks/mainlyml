---
- name: Install rsync
  ansible.builtin.yum:
    name: rsync
    state: present
  become: true

- name: Install logrotate
  ansible.builtin.yum:
    name: logrotate
    state: present
  become: true

- name: Create /var/backups directory
  ansible.builtin.file:
    path: /var/backups
    state: directory
    mode: '0755'
    owner: root
    group: root
  become: true

- name: Create backup script
  ansible.builtin.copy:
    dest: /usr/local/bin/daily-backup.sh
    content: |
      #!/bin/bash
      rsync -av --delete /etc /var/backups/
    mode: '0755'
    owner: root
    group: root
  become: true

- name: Add cron job for daily backup
  ansible.builtin.cron:
    name: "Daily backup"
    minute: "0"
    hour: "2"
    job: "/usr/local/bin/daily-backup.sh"
  become: true

